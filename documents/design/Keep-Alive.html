











<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>



    <meta name="author" content="Stefan Eilemann">







    <meta name="robots" content="index,follow">
    <link rev="made" href="mailto:webmaster@equalizergraphics.com" title="Stefan Eilemann">
    <link rel="home" href="http://www.equalizergraphics.com/" title="Home Page">
    <link rel="icon" href="http://www.equalizergraphics.com/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/stylesheet.css" type="text/css" media="screen">
    <link rel="stylesheet" href="/print.css" type="text/css" media="print">
    <link rel="alternate" title="Equalizer RSS"
          href="http://www.equalizergraphics.com/equalizer.rdf"
          type="application/rss+xml">
    <script type="text/javascript"
            src="http://apis.google.com/js/plusone.js"></script>

    <title>Equalizer: Documentation: Developer: Keep-Alive</title>
  </head>

  <body>
    <div class="poll">
        <a href="http://www.equalizergraphics.com/">

          <img src="/images/Equalizer.png" alt="Equalizer logo" class="active"></a>



        <br>
        <a href="http://www.libcollage.net">



          <img src="/images/Collage_g.png" alt="Collage logo"></a>

        <br>
        <a href="http://www.equalizergraphics.com/gpu-sd">



          <img src="/images/gpusd_g.png" alt="GPU-SD logo"></a>

        <br>

      <!-- What is new? -->
      <div class="subnavigation"><center>
          <b>What is new?</b><br>
          <a href="https://github.com/Eyescale/equalizergraphics.com/commits/master/">Latest Website Changes</a><br>
          <a href="https://github.com/Eyescale/Equalizer/commits/master/">Latest
            Source Code Changes</a><br>
          <a href="http://pogl.wordpress.com/">Developer Blog</a><br>
          <b>New:</b><a href="http://twitter.com/EqualizerTricks">Tips &amp; Tricks on Twitter</a>
      </center></div>

    </div>
    <div class="header">
      <a name="top"></a>

      <h1>Keep-Alive</h1>







    </div>

    <!-- Footer line -->
    <div class="footer">
      <a href="/documents/design/Keep-Alive.html#top" class="rule">Back to top</a>
      <a href="mailto:info@equalizergraphics.com?subject=Question regarding Equalizer: Documentation: Developer: Keep-Alive" class="rule">Questions?</a>
      <a href="/impressum.html" class="rule">Impressum</a>

      <a href="https://github.com/Eyescale/equalizergraphics.com/commits/master/documents/design/Keep-Alive.shtml" class="rule">Changed </a>

      <a href="#search">Search</a>
    </div>

    <!-- Navigation -->
    <div class="navigation">




      <p><a href="/index.html"



            >About</a></p>

      <!-- About sub-navigation-->

      <p><a href="/features.html"



            >Features</a></p>


      <p><a href="/applications.html"



            >Applications</a></p>

      <!-- Applications sub-navigation-->

      <p><a href="/documentation.html"



            >Documentation</a></p>

      <!-- Documentation sub-navigation-->

      <div class="subnavigation">
        <p><a href="/documentation/user.html"



              >User</a></p>

        <p><a href="/documentation/developer.html"

              class="used"

              >Developer</a></p>

        <p><a href="/documentation/publications.html"



              >Publications</a></p>

        <p><a href="/relnotes.html"



              >Release Notes</a></p>

        <p><a href="/documentation/performance.html"



              >Performance Studies</a></p>

        <p><a href="/compatibility.html"



              >Compatibility Matrix</a></p>

        <p><a href="/documentation/parallelOpenGLFAQ.html"



              >Parallel GL FAQ</a></p>
      </div>


      <p><a href="/support.html"



            >Support</a></p>

      <!-- Support sub-navigation-->

      <p><a href="/gallery.html"



            >Gallery</a></p>


      <p><a href="/downloads.html"



            >Downloads</a></p>

      <!-- Downloads sub-navigation-->

      <p><a href="/news.html"



            >News</a></p>


      <p><a href="/events.html"



            >Events</a></p>


      <p><a href="/contributions.html"



            >Contributions</a></p>

      <p><a href="/survey.html"



            >Survey</a></p>




      <div class="float_right"><g:plusone></g:plusone></div>
      <div class="flush_float"></div
      <!-- social bookmark sites -->
      <div class="social">
        <div class="addthis_toolbox addthis_default_style ">
          <a class="addthis_button_preferred_1"></a>
          <a class="addthis_button_preferred_2"></a>
          <a class="addthis_button_preferred_3"></a>
          <a class="addthis_button_preferred_4"></a>
          <a class="addthis_button_compact"></a>
          <a class="addthis_counter addthis_bubble_style"></a>
        </div>
        <script type="text/javascript">var addthis_config =
          {"data_track_addressbar":true};</script>
        <script type="text/javascript"
                src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=eile">
        </script>
        <script type="text/javascript">
          var addthis_config = {
          data_track_clickback: false
          }
      </script>
      </div>

    </div>
    <div class="content">


<p>Author: <a href="mailto:dulley@gmail.com">Lucas Peetz Dulley</a></p>
<p>State: Design</p>
<h2 id="overview">Overview</h2>
<p>The goal of this feature is to instrument Collage LocalNodes to be aware of its connected
remote notes status/lastAliveTime.</p>
<p>The current timeout value as now accompanied by a keep alive setting. Blocking operations check every keep alive ms if the peer node is still alive, otherwise they throw the timeout exception early. The timeout value determines the maximum wait time, even if the remote peer is still communicating (catches deadlocks).</p>
<h2 id="requirements">Requirements</h2>
<h3 id="co">CO</h3>
<ul>
<li>Keep-alive feature is always-on.</li>
<li>Whenever receiver thread receives data (EVENT_DATA) from a remote node, the lastAliveTime
  for the node is updated.</li>
<li>eile: A node sends every keepalive ms a dummy keepalive packet to its peers if it has not send data to them.
** eile: TBD internal or external keepalive default value?</li>
</ul>
<h3 id="eq">EQ</h3>
<ul>
<li>eile: Equalizer times out blocking operations after keepalive ms (or remaining timeout, if smaller), sends ping, blocks again for up to keepalive ms, then checks the peer node status</li>
<li>E.g.: EqPly can open heavy .ply files (e.g., lucy.ply) without failing due to frame
  rendering timeouts while the model is being distributed.</li>
</ul>
<h2 id="api">API</h2>
<p>co::Node:</p>
<pre><code>/** The node is responding (is alive) */
int64_t _lastReceive; //!&lt; last time packets where received
int64_t co::Node::getLastReceiveTime() const // access to nodes LastAliveTime
</code></pre>
<p>co::LocalNode:</p>
<pre><code>bool co::LocalNode::_ping( NodePtr remoteNode ); // requests keepalive from remote node
// it just sends the packets when we need them to be sent.

/** process ping request. called from receiver thread (not queued in command queue) */
// updates lastAliveTime in receiver thread for the node which sent the packet
// sends a ping reply packet to "local" node
bool co::LocalNode::_cmdPing( Command&amp; command );

/** process ping reply response. called from receiver thread (not queued in command queue) */
// eile: not needed, use _cmdDiscard and no queue. _lastReceiveTime was already updated by _handleData
    //updates lastAliveTime for the node which replied the packet
// remoteNode-&gt;_lastAliveTime = getTime64();
bool co::LocalNode::_cmdPingReply( Command&amp; command );
</code></pre>
<p>Ping Packets:</p>
<pre><code>/** NEW: node ping packet */
co::NodePingPacket
    // eile: no need: uint64_t transmitTime;
/** NEW: node ping reply packet */
co::NodePingReplyPacket( const NodePingPacket* request): transmitTime( request-&gt;transmitTime );
    // eile:dito: uint64_t transmitTime;
</code></pre>
<p>eq::</p>
<pre><code>Config::setTimout ( int64_t timeout = EQ_TIMEOUT_DEFAULT ) // where should it be set? eile: same place as today?
</code></pre>
<h2 id="usage">Usage</h2>
<ul>
<li>From the Application PoV, it only needs to set the Timeout and potentially keepalive time. (so the App sets Timeout to a big value)
This will define the number of retries in the critical EQ timeouts to timeout / keepalive / 2 (like finishFrame... ). </li>
<li>The retry is only considered if the node is considered alive.
The number of retries goes from zero ( Timeout &lt; EQ_TIMEOUT_KEEPALIVE ) to infinite ( Timeout == EQ_TIMEOUT_INDEFINITE )
Exception is thrown in "Timeout/EQ_TIMEOUT_KEEPALIVE" ms if node is dead (considered after X retries).</li>
</ul>
<h2 id="file-format">File Format</h2>
<p>No changes.</p>
<h2 id="restrictions">Restrictions</h2>
<p>The Collage-based keep-alive signal does not take any action deciding whether a
remote node is responsive or not. It only gathers and provides information about
the actual remote nodes alive states from the local node perspective.</p>
<ul>
<li>EQ acts on the keep alive information agreeing to retry a timed-out operation if the node seems to be alive.</li>
</ul>
<h2 id="issues">Issues</h2>
<p>Q: Name of the timeouts to make it less confusing.</p>
<p>eile: see proposal above.</p>



  <!-- Search Results -->
  <div class="flush_float"></div>
  <div class="search"><a name="search"></a>
    <div id="cse"></div>
    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript">
      google.load('search', '1', {language : 'en'});
      google.setOnLoadCallback(function(){
      var customSearchControl = new
      google.search.CustomSearchControl('003884678311182543665:v1o4knw6fuq');
      customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
      customSearchControl.draw('cse');
      }, true);
    </script>
    <link rel="stylesheet"
          href="http://www.google.com/cse/style/look/default.css"
          type="text/css" />
  </div>

  <!-- social bookmark sites, added here again for convenience and to WAR
       ignored bottom margin on IE7 -->
  <div class="social">
    <script type="text/javascript">addthis_pub = 'eile';</script>
    <a href="http://www.addthis.com/bookmark.php"
       onmouseover="return addthis_open(this, '', '[URL]', '[TITLE]')"
       onmouseout="addthis_close()"
       onclick="return addthis_sendto()">
      <img src="http://s9.addthis.com/button1-bm.gif" width="125" height="16"
           border="0" alt="" />
    </a>
    <script type="text/javascript"
            src="http://s7.addthis.com/js/152/addthis_widget.js">
    </script>
  </div>

</div> <!-- div content -->


<!-- Google Analytics -->
<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  try {
  var pageTracker = _gat._getTracker("UA-63007-1");
  pageTracker._trackPageview();
  } catch(err) {}
</script>

</body>

</html>

