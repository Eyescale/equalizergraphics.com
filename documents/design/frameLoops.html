














<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>



    <meta name="author" content="Stefan Eilemann">







    <meta name="robots" content="index,follow">
    <link rev="made" href="mailto:webmaster@equalizergraphics.com" title="Stefan Eilemann">
    <link rel="home" href="http://www.equalizergraphics.com/" title="Home Page">
    <link rel="icon" href="http://www.equalizergraphics.com/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/equalizergraphics.com/stylesheet.css" type="text/css" media="screen">
    <link rel="stylesheet" href="/equalizergraphics.com/print.css" type="text/css" media="print">
    <link rel="alternate" title="Equalizer RSS"
          href="http://www.equalizergraphics.com/equalizer.rdf"
          type="application/rss+xml">
    <script type="text/javascript"
            src="http://apis.google.com/js/plusone.js"></script>

    <title>Equalizer: Documentation: Developer: Independent Frame Loops</title>
  </head>

  <body>
    <div class="poll">
        <a href="http://www.equalizergraphics.com/">

          <img src="/images/Equalizer.png" alt="Equalizer logo" class="active"></a>



        <br>
        <a href="http://www.libcollage.net">



          <img src="/images/Collage_g.png" alt="Collage logo"></a>

        <br>
        <a href="http://www.equalizergraphics.com/gpu-sd">



          <img src="/images/gpusd_g.png" alt="GPU-SD logo"></a>

        <br>

      <!-- What is new? -->
      <div class="subnavigation"><center>
          <b>What is new?</b><br>
          <a href="https://github.com/Eyescale/equalizergraphics.com/commits/master/">Latest Website Changes</a><br>
          <a href="https://github.com/Eyescale/Equalizer/commits/master/">Latest
            Source Code Changes</a><br>
          <a href="http://pogl.wordpress.com/">Developer Blog</a><br>
          <b>New:</b><a href="http://twitter.com/EqualizerTricks">Tips &amp; Tricks on Twitter</a>
      </center></div>

    </div>
    <div class="header">
      <a name="top"></a>

      <h1>Independent Frame Loops</h1>







    </div>

    <!-- Footer line -->
    <div class="footer">
      <a href="/documents/design/frameLoops.html#top" class="rule">Back to top</a>
      <a href="mailto:info@equalizergraphics.com?subject=Question regarding Equalizer: Documentation: Developer: Independent Frame Loops" class="rule">Questions?</a>
      <a href="/equalizergraphics.com/impressum.html" class="rule">Impressum</a>

      <a href="https://github.com/Eyescale/equalizergraphics.com/commits/master/documents/design/frameLoops.shtml" class="rule">Changed Mon Mar 29 07:38:41 2010 +0000</a>

      <a href="#search">Search</a>
    </div>

    <!-- Navigation -->
    <div class="navigation">





      <p><a href="/equalizergraphics.com/index.html"



            >About</a></p>

      <!-- About sub-navigation-->

      <p><a href="/equalizergraphics.com/features.html"



            >Features</a></p>


      <p><a href="/equalizergraphics.com/applications.html"



            >Applications</a></p>

      <!-- Applications sub-navigation-->

      <p><a href="/equalizergraphics.com/documentation.html"



            >Documentation</a></p>

      <!-- Documentation sub-navigation-->

      <div class="subnavigation">
        <p><a href="/equalizergraphics.com/documentation/user.html"



              >User</a></p>

        <p><a href="/equalizergraphics.com/documentation/developer.html"

              class="used"

              >Developer</a></p>

        <p><a href="/equalizergraphics.com/documentation/publications.html"



              >Publications</a></p>

        <p><a href="/equalizergraphics.com/relnotes.html"



              >Release Notes</a></p>

        <p><a href="/equalizergraphics.com/documentation/performance.html"



              >Performance Studies</a></p>

        <p><a href="/equalizergraphics.com/compatibility.html"



              >Compatibility Matrix</a></p>

        <p><a href="/equalizergraphics.com/documentation/parallelOpenGLFAQ.html"



              >Parallel GL FAQ</a></p>
      </div>


      <p><a href="/equalizergraphics.com/support.html"



            >Support</a></p>

      <!-- Support sub-navigation-->

      <p><a href="/equalizergraphics.com/gallery.html"



            >Gallery</a></p>


      <p><a href="/equalizergraphics.com/downloads.html"



            >Downloads</a></p>

      <!-- Downloads sub-navigation-->

      <p><a href="/equalizergraphics.com/news.html"



            >News</a></p>


      <p><a href="/equalizergraphics.com/events.html"



            >Events</a></p>


      <p><a href="/equalizergraphics.com/contributions.html"



            >Contributions</a></p>

      <p><a href="/equalizergraphics.com/survey.html"



            >Survey</a></p>




      <div class="float_right"><g:plusone></g:plusone></div>
      <div class="flush_float"></div
      <!-- social bookmark sites -->
      <div class="social">
        <div class="addthis_toolbox addthis_default_style ">
          <a class="addthis_button_preferred_1"></a>
          <a class="addthis_button_preferred_2"></a>
          <a class="addthis_button_preferred_3"></a>
          <a class="addthis_button_preferred_4"></a>
          <a class="addthis_button_compact"></a>
          <a class="addthis_counter addthis_bubble_style"></a>
        </div>
        <script type="text/javascript">var addthis_config =
          {"data_track_addressbar":true};</script>
        <script type="text/javascript"
                src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=eile">
        </script>
        <script type="text/javascript">
          var addthis_config = {
          data_track_clickback: false
          }
      </script>
      </div>

    </div>
    <div class="content">


<p>
Author: <a href="mailto:eilemann@gmail.com">eilemann@gmail.com</a><br/>
State: Design
</p>

<h2>Overview</h2>
<p>
  The purpose of this feature is to allow decoupled framerates in separate
  views, so that the rendering performance of one view is not coupled to another
  view.
</p>

<h2>Requirements</h2>
<ul>
  <li>One configuration is used. The configuration is one visualization session
    of an application. It is not feasible to create multiple configurations, as
    this would require a separate mechanism for data distribution.</li>
  <li>The independent frame loops can be driven from one main thread. Using one
    thread per frame loop is the easy way, but creates numerous thread-safety
    issues for developers.</li>
  <li>Views sharing resources may be coupled. The obvious example is the update
    of two views sharing one window.</li>
</ul>

<h2>Implementation</h2>
<p>
  Currently, the application starts a rendering for all views of a configuration
  using <code>Config::startFrame</code>. To synchronize the
  completion, <code>Config::finishFrame</code> is used, which waits on:
  <ul>
    <li>The completion of all node-local draw operations of all views (with the
      default thread model <code>draw_sync</code>)</li>
    <li>The completion of all operations of all views for
      frame <code>current-latency</code></li>
  </ul>
</p>
<p>
  For per-view frame loops, the application wants to wait on the completion of
  one view to request a redraw on this view, if needed. Multiple views need to
  be updateable at once.
</p>
<!-- /* --><pre>
while( config->isRunning( ))
{
    version = commit();
    config->startFrame( version );
    View* view = config->finishView();
    while no redraw needed
        for each ready view
            update view redraw state
}

eq::server::Config::startFrame()
{
    generate tasks for ready, redraw views
}

eq::Config::finishFrame()
{
    for each active view
        view->finishFrame();
        view->postRedraw();
OR
    View* view = config->finishView();
    view->postRedraw();
}
</pre><!-- */ -->

<h2>File Format</h2>
<!-- /* --><pre>
</pre><!-- */ -->

<h2>API</h2>
<!-- /* --><pre>
</pre><!-- */ -->

<h2>Implementation</h2>

<h2>Issues</h2>
<h3>1. Are the frame loops per view or per observer?</h3>
<p>
  Resolved: Per view. Running per observer seems more logical at first. However,
  one observer might observe multiple views with different content. The observer
  does not necessarily require a synchronization between theses views.
</p>

<h3>2. What happens to view a, if view b is updated and they share a
  window?</h3>
<p>
  There are two situations: view a is idle or it is actively rendering a
  frame. Situation two may never arise, since the resource would not be ready
  yet and the per-view synchronization of both views would not yet have
  triggered.
</p>
<p>
  Option 1: All dependent destination channels are updated as well. One issue
  is that the data used for the redraw does no longer correspond to the data
  used when updating the full view, i.e., an update of view b would fully
  trigger an update of view a.
</p>
<p>
  Option 2: Equalizer saves the front buffer before swap. A new task
  method <code>Channel::frameViewRestore</code> would perform a glCopyPixels
  from the front to the back buffer. A possibly destroyed front buffer would not
  be an issue, as this would trigger a redraw in any case. Application
</p>

<h3>3. What is the basic synchronization entity?</h3>
<p>
  From an OpenGL POV, all views of a single drawable are dependent. From a
  multithreading POV, all views of a single thread (aka pipe) are
  dependent. From an application POV, all views of a single process (aka node)
  are dependent, if one database is used per process.
</p>
<p>
  The thread model should take care of enforcing the appropriate synchronization
  by not allowing a new frame to start if a dependent resource is still used for
  another view.
</p>

<h3>4. How is the latency handled?</h3>
<p>
  A configuration has a latency of <code>n</code> frames. When running with
  multiple framerates, one view should be able to get ahead more than n frames.
</p>
<p>
  Option: Consider the latency per view.
</p>




  <!-- Search Results -->
  <div class="flush_float"></div>
  <div class="search"><a name="search"></a>
    <div id="cse"></div>
    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript">
      google.load('search', '1', {language : 'en'});
      google.setOnLoadCallback(function(){
      var customSearchControl = new
      google.search.CustomSearchControl('003884678311182543665:v1o4knw6fuq');
      customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
      customSearchControl.draw('cse');
      }, true);
    </script>
    <link rel="stylesheet"
          href="http://www.google.com/cse/style/look/default.css"
          type="text/css" />
  </div>

  <!-- social bookmark sites, added here again for convenience and to WAR
       ignored bottom margin on IE7 -->
  <div class="social">
    <script type="text/javascript">addthis_pub = 'eile';</script>
    <a href="http://www.addthis.com/bookmark.php"
       onmouseover="return addthis_open(this, '', '[URL]', '[TITLE]')"
       onmouseout="addthis_close()"
       onclick="return addthis_sendto()">
      <img src="http://s9.addthis.com/button1-bm.gif" width="125" height="16"
           border="0" alt="" />
    </a>
    <script type="text/javascript"
            src="http://s7.addthis.com/js/152/addthis_widget.js">
    </script>
  </div>

</div> <!-- div content -->


<!-- Google Analytics -->
<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  try {
  var pageTracker = _gat._getTracker("UA-63007-1");
  pageTracker._trackPageview();
  } catch(err) {}
</script>

</body>

</html>


