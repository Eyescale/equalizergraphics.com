














<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>



    <meta name="author" content="Stefan Eilemann">







    <meta name="robots" content="index,follow">
    <link rev="made" href="mailto:webmaster@equalizergraphics.com" title="Stefan Eilemann">
    <link rel="home" href="http://www.equalizergraphics.com/" title="Home Page">
    <link rel="icon" href="http://www.equalizergraphics.com/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/stylesheet.css" type="text/css" media="screen">
    <link rel="stylesheet" href="/print.css" type="text/css" media="print">
    <link rel="alternate" title="Equalizer RSS"
          href="http://www.equalizergraphics.com/equalizer.rdf"
          type="application/rss+xml">
    <script type="text/javascript"
            src="http://apis.google.com/js/plusone.js"></script>

    <title>Equalizer: Documentation: Developer: Event Handling</title>
  </head>

  <body>
    <div class="poll">
        <a href="http://www.equalizergraphics.com/">

          <img src="/images/Equalizer.png" alt="Equalizer logo" class="active"></a>



        <br>
        <a href="http://www.libcollage.net">



          <img src="/images/Collage_g.png" alt="Collage logo"></a>

        <br>
        <a href="http://www.equalizergraphics.com/gpu-sd">



          <img src="/images/gpusd_g.png" alt="GPU-SD logo"></a>

        <br>

      <!-- What is new? -->
      <div class="subnavigation"><center>
          <b>What is new?</b><br>
          <a href="https://github.com/Eyescale/equalizergraphics.com/commits/master/">Latest Website Changes</a><br>
          <a href="https://github.com/Eyescale/Equalizer/commits/master/">Latest
            Source Code Changes</a><br>
          <a href="http://pogl.wordpress.com/">Developer Blog</a><br>
          <b>New:</b><a href="http://twitter.com/EqualizerTricks">Tips &amp; Tricks on Twitter</a>
      </center></div>

    </div>
    <div class="header">
      <a name="top"></a>

      <h1>Event Handling</h1>







    </div>

    <!-- Footer line -->
    <div class="footer">
      <a href="/documents/design/eventHandling.html#top" class="rule">Back to top</a>
      <a href="mailto:info@equalizergraphics.com?subject=Question regarding Equalizer: Documentation: Developer: Event Handling" class="rule">Questions?</a>
      <a href="/impressum.html" class="rule">Impressum</a>

      <a href="https://github.com/Eyescale/equalizergraphics.com/commits/master/documents/design/eventHandling.shtml" class="rule">Changed Mon Aug 15 08:12:00 2011 +0200</a>

      <a href="#search">Search</a>
    </div>

    <!-- Navigation -->
    <div class="navigation">





      <p><a href="/index.html"



            >About</a></p>

      <!-- About sub-navigation-->

      <p><a href="/features.html"



            >Features</a></p>


      <p><a href="/applications.html"



            >Applications</a></p>

      <!-- Applications sub-navigation-->

      <p><a href="/documentation.html"



            >Documentation</a></p>

      <!-- Documentation sub-navigation-->

      <div class="subnavigation">
        <p><a href="/documentation/user.html"



              >User</a></p>

        <p><a href="/documentation/developer.html"

              class="used"

              >Developer</a></p>

        <p><a href="/documentation/publications.html"



              >Publications</a></p>

        <p><a href="/relnotes.html"



              >Release Notes</a></p>

        <p><a href="/documentation/performance.html"



              >Performance Studies</a></p>

        <p><a href="/compatibility.html"



              >Compatibility Matrix</a></p>

        <p><a href="/documentation/parallelOpenGLFAQ.html"



              >Parallel GL FAQ</a></p>
      </div>


      <p><a href="/support.html"



            >Support</a></p>

      <!-- Support sub-navigation-->

      <p><a href="/gallery.html"



            >Gallery</a></p>


      <p><a href="/downloads.html"



            >Downloads</a></p>

      <!-- Downloads sub-navigation-->

      <p><a href="/news.html"



            >News</a></p>


      <p><a href="/events.html"



            >Events</a></p>


      <p><a href="/contributions.html"



            >Contributions</a></p>

      <p><a href="/survey.html"



            >Survey</a></p>




      <div class="float_right"><g:plusone></g:plusone></div>
      <div class="flush_float"></div
      <!-- social bookmark sites -->
      <div class="social">
        <div class="addthis_toolbox addthis_default_style ">
          <a class="addthis_button_preferred_1"></a>
          <a class="addthis_button_preferred_2"></a>
          <a class="addthis_button_preferred_3"></a>
          <a class="addthis_button_preferred_4"></a>
          <a class="addthis_button_compact"></a>
          <a class="addthis_counter addthis_bubble_style"></a>
        </div>
        <script type="text/javascript">var addthis_config =
          {"data_track_addressbar":true};</script>
        <script type="text/javascript"
                src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=eile">
        </script>
        <script type="text/javascript">
          var addthis_config = {
          data_track_clickback: false
          }
      </script>
      </div>

    </div>
    <div class="content">


<p>
  Author: <a href="mailto:eilemann@gmail.com">eilemann@gmail.com</a><br/>
  State:
  <ul>
    <li>GLX implemented in 0.2</li>
    <li>WGL implemented in 0.3</li>
    <li>AGL implemented in 0.4</li>
    <li>Message pump configuration and removal of (glX) event thread in 0.5</li>
    <li>AGL event dispatch to pipe threads in 0.9</li>
  </ul>
</p>

<p>
  Equalizer implements a basic event handling mechanism, simplifying the
  development of small-sized to medium-sized applications. Complex applications
  are expected to implement their own event handling, and disable the event
  handling in Equalizer.
</p>
<p>
  Equalizer normally receives and processes the events from the pipe thread the
  window belongs to. The exception is the AGL window system, which dispatches
  all events from the main thread.
</p>
<div class="float_right">
  <a href="/documents/design/images/eventFilter.png">
    <img src="/documents/design/images/eventFilter-small.jpg"
         alt="Event Handling Data Flow"/></a>
  <div class="label">Event Handling Data Flow</div>
</div>
<p>
  When the event handler receives an event from the window system, it finds the
  associated <code>eq::Window</code> and creates a
  generic <code>WindowEvent</code> from the system-specific event. The generic
  event contains the system-specific event, i.e., the X11 Event, and is passed
  to <code>Window::processEvent</code>. The default implementation
  of <code>Window::processEvent</code> transform the window event into
  a <code>ConfigEvent</code>, which is sent to the application thread
  using <code>Config::sendEvent</code>. Since the config event is potentially
  transferred to another node, it no longer contains the system-specific event.
</p><p>
  At the end of the frame, <code>Config::endFrame</code>
  calls <code>Config::processEvent</code> on each queued event. The default
  implementation is empty, the <code>eqPly</code> example implements some basic
  mouse and keyboard interaction.
</p>
<p>
  The event dispatch is implemented by subclassing
  <a href="/cgi-bin/viewvc.cgi/trunk/src/libs/co/commandQueue.cpp?view=markup">co::CommandQueue</a>
  into a
  <a href="/cgi-bin/viewvc.cgi/trunk/src/lib/eq/commandQueue.cpp?view=markup">eq::CommandQueue</a>
  which 'pumps' events on every pop operation. The CommandQueue is used between
  the receiver and the rendering threads to dispatch the received
  commands. Consequently, events are only processed in between task
  commands. The WGL implementation pumps events in each node and pipe thread.
</p>


<h2>External Message Pump</h2>
<p>
  Equalizer dispatches the window system events automatically between the
  execution of two task methods. External toolkits, e.g., QT, might implement a
  message pump themselves. It is therefore desirable to disable the message pump
  for application and/or pipe threads to avoid side effect of event dispatch at
  an unexpected time for the external toolkit.
</p>
<p>
  The virtual method <code>useMessagePump</code> is called by Equalizer during
  application and pipe thread initialization (before configInit!) to determine
  if the pipe thread shall automatically dispatch OS events. Messages are always
  dispatched to the window's pipe thread. If useMessagePump returns false, the
  application has to dispatch events itself.
</p>

<h2>Customized Event Handling</h2>
<p>
  The application can provide its own event handler implementation
  in <code>Pipe::initEventHandler</code>
  and <code>Window::initEventHandler</code>. Typically these methods are
  overwritten to disable Equalizer's event handling by providing an empty
  implementation.
</p>

<h2>API</h2>
<!-- /* --><pre>
  virtual bool Window::processEvent( const WindowEvent& event );
  void Config::sendEvent( ConfigEvent& event );

  const ConfigEvent* Config::nextEvent();
  bool Config::checkEvent() const;
  virtual void Config::handleEvents();
  virtual bool Config::handleEvent( const ConfigEvent* event );

  class WindowEvent;
  struct ConfigEvent;

  virtual bool Pipe::useMessagePump()   { return true; }

  virtual void Pipe::initEventHandler();
  virtual void Pipe::exitEventHandler();
  virtual void Window::initEventHandler();
  virtual void Window::exitEventHandler();
</pre><!-- */ -->

<h2>Open Issues</h2>
<p>
  None
</p>




  <!-- Search Results -->
  <div class="flush_float"></div>
  <div class="search"><a name="search"></a>
    <div id="cse"></div>
    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript">
      google.load('search', '1', {language : 'en'});
      google.setOnLoadCallback(function(){
      var customSearchControl = new
      google.search.CustomSearchControl('003884678311182543665:v1o4knw6fuq');
      customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
      customSearchControl.draw('cse');
      }, true);
    </script>
    <link rel="stylesheet"
          href="http://www.google.com/cse/style/look/default.css"
          type="text/css" />
  </div>

  <!-- social bookmark sites, added here again for convenience and to WAR
       ignored bottom margin on IE7 -->
  <div class="social">
    <script type="text/javascript">addthis_pub = 'eile';</script>
    <a href="http://www.addthis.com/bookmark.php"
       onmouseover="return addthis_open(this, '', '[URL]', '[TITLE]')"
       onmouseout="addthis_close()"
       onclick="return addthis_sendto()">
      <img src="http://s9.addthis.com/button1-bm.gif" width="125" height="16"
           border="0" alt="" />
    </a>
    <script type="text/javascript"
            src="http://s7.addthis.com/js/152/addthis_widget.js">
    </script>
  </div>

</div> <!-- div content -->


<!-- Google Analytics -->
<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  try {
  var pageTracker = _gat._getTracker("UA-63007-1");
  pageTracker._trackPageview();
  } catch(err) {}
</script>

</body>

</html>

<!-- $Id$ -->
